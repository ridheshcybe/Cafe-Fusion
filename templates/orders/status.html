{% extends 'layout.html' %}
{% block title %}Order #{{ order.id }} - Caf√© Fusion{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 m-0">Order #{{ order.id }}</h1>
  <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('orders.track_form') }}">Track Another</a>
</div>

<div class="card">
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <div class="text-muted">Status</div>
        <div class="fs-5">{{ label }}</div>
        <div class="text-muted mt-2">Mode</div>
        <div>{{ order.mode }}</div>
      </div>
      <div class="col-md-6">
        <div class="text-muted">Customer</div>
        <div>{{ order.customer_name }} ({{ order.customer_phone }})</div>
        <div class="text-muted mt-2">Created</div>
        <div>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
      </div>
    </div>

    <hr />

    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Item</th>
            <th class="text-end">Unit</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for it in order.items %}
            <tr>
              <td>{{ it.menu_item.name }}</td>
              <td class="text-end">{{ it.unit_price_cents|money }}</td>
              <td class="text-end">{{ it.quantity }}</td>
              <td class="text-end">{{ it.line_total_cents|money }}</td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Subtotal</th>
            <th class="text-end">{{ order.subtotal_cents|money }}</th>
          </tr>
          <tr>
            <th colspan="3" class="text-end">Discount</th>
            <th class="text-end">- {{ order.discount_cents|money }}</th>
          </tr>
          <tr>
            <th colspan="3" class="text-end">Total</th>
            <th class="text-end">{{ order.total_cents|money }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

    {% if session.get('role') == 'staff' %}
      <div class="mt-2">
        <a class="btn btn-outline-dark" href="{{ url_for('staff.invoice_pdf', order_id=order.id) }}">Invoice PDF</a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
